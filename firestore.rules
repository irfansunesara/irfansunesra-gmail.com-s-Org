
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Each user's data is stored in a document under the 'users' collection,
    // where the document ID is the user's unique Firebase Authentication ID (uid).
    match /users/{userId} {
      // This rule is the most important part of your app's security.
      // It guarantees that a user can ONLY read, write, update, or delete
      // a document if their authenticated user ID (request.auth.uid)
      // exactly matches the ID of the document they are trying to access (userId).
      // This provides absolute data isolation and privacy.
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
  }
}
